# OmniSage Frontend

OmniSage 前端是一个基于 Gradio 构建的智能问答系统用户界面，提供直观的交互体验和完整的知识库管理功能。

## 功能特性

- 🎨 **现代化界面**: 基于 Gradio 的直观用户界面
- 📚 **知识库管理**: 完整的知识库创建、管理和文件上传功能
- 💬 **智能对话**: 支持多种模式的智能问答
- 🎤 **语音识别**: 集成 Vosk 离线语音识别
- 🔐 **用户认证**: 完整的登录和会话管理
- 📊 **对话历史**: 完整的对话记录和管理
- 🔑 **API 密钥管理**: 用户 API 密钥的创建和管理

## 技术栈

- **Gradio**: 快速构建 ML 应用界面
- **Vosk**: 离线语音识别
- **Requests**: HTTP 客户端
- **uv**: 快速 Python 包管理器
- **Python**: 后端逻辑

## 项目结构

```
frontend/
├── app.py                          # 主应用文件
├── vosk-model-small-cn-0.22/       # 中文语音识别模型
├── pyproject.toml                  # 项目配置和依赖管理
├── README.md                       # 项目文档
├── README_Frontend_KnowledgeBase.md # 知识库功能详细说明
└── README_Wiki_Integration.md      # Wiki 集成功能说明
```

## 快速开始

### 1. 环境要求

- Python 3.11+
- uv 包管理器
- 后端服务已启动并运行在 `http://localhost:8000`

### 2. 安装 uv (如果未安装)

```bash
# 使用 pip 安装 uv
pip install uv

# 或使用官方安装脚本
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### 3. 设置项目环境

```bash
# 进入前端目录
cd frontend

# 使用 uv 创建虚拟环境并安装依赖
uv sync
```

### 4. 启动前端服务

```bash
# 使用 uv 运行应用
uv run python app.py
```

前端服务将在 `http://localhost:7860` 启动。

## 主要功能

### 1. 用户认证

- **用户注册**: 创建新用户账户
- **用户登录**: 使用用户名和密码登录
- **会话管理**: 自动保持登录状态

### 2. 知识库管理

#### 创建知识库
- 输入知识库名称和描述
- 一键创建新的知识库

#### 文件管理
- 支持多种文档格式上传
- 文件自动向量化处理
- 文件删除和管理

#### 知识库统计
- 显示知识库数量
- 显示总文档块数量
- 显示总文件数量

### 3. 智能对话

#### 对话模式
- **普通对话**: 直接与 LLM 对话
- **RAG 模式**: 基于知识库的检索增强生成
- **Wiki 模式**: 基于维基百科知识的问答

#### 对话功能
- 多轮对话支持
- 对话历史记录
- 对话删除功能

### 4. 语音识别

- **离线识别**: 使用 Vosk 模型进行离线语音识别
- **中文支持**: 专门针对中文优化的识别模型
- **实时转换**: 语音实时转换为文本

### 5. API 密钥管理

- **创建密钥**: 生成新的 API 密钥
- **查看密钥**: 显示所有 API 密钥
- **删除密钥**: 删除不需要的密钥

## 界面布局

### 左侧边栏 - 知识库管理

```
📚 知识库管理
├── 新建知识库
│   ├── 知识库名称输入框
│   ├── 知识库描述输入框
│   └── 新建按钮
├── 我的知识库
│   ├── 知识库选择下拉框
│   ├── 删除知识库按钮
│   └── 刷新按钮
├── 知识库统计信息
├── 文件上传
│   ├── 文件选择器
│   └── 上传按钮
└── 知识库文件
    ├── 文件列表下拉框
    └── 删除文件按钮
```

### 主界面 - 对话区域

- **聊天界面**: 显示对话历史
- **输入区域**: 文本输入和语音输入
- **发送按钮**: 发送消息

### 右侧边栏 - 控制面板

- **模式选择**: 普通/RAG/Wiki 模式切换
- **对话管理**: 对话历史列表
- **API 密钥**: API 密钥管理
- **语音识别**: 语音输入控制

## 使用指南

### 1. 首次使用

1. 启动前端服务
2. 注册新用户账户
3. 登录系统
4. 创建第一个知识库

### 2. 知识库管理

#### 创建知识库
1. 在左侧知识库管理区域
2. 输入知识库名称（必填）
3. 输入知识库描述（可选）
4. 点击"新建"按钮

#### 上传文件
1. 选择目标知识库
2. 点击"选择文件"按钮
3. 选择要上传的文档
4. 点击"上传到知识库"按钮

#### 管理文件
1. 选择知识库查看文件列表
2. 查看文件详细信息
3. 删除不需要的文件

### 3. 智能对话

#### 普通对话
1. 确保模式选择为"普通"
2. 直接输入问题
3. 点击发送或按回车

#### RAG 对话
1. 选择"RAG"模式
2. 确保已上传相关文档
3. 输入问题，系统会自动检索相关知识

#### Wiki 对话
1. 选择"Wiki"模式
2. 输入问题，系统会从维基百科检索信息

### 4. 语音输入

1. 点击语音输入按钮
2. 允许麦克风权限
3. 开始说话
4. 语音会自动转换为文本

## 配置说明

### 后端服务配置

前端默认连接到 `http://localhost:8000` 的后端服务。如需修改，请编辑 `app.py` 中的 `BACKEND_URL` 变量。

### 语音识别配置

语音识别使用 Vosk 模型，模型文件位于 `vosk-model-small-cn-0.22/` 目录。

## 依赖管理

本项目使用 uv 进行依赖管理，配置文件为 `pyproject.toml`。

### 常用 uv 命令

```bash
# 安装依赖
uv sync

# 添加新依赖
uv add package_name

# 添加开发依赖
uv add --dev package_name

# 运行 Python 脚本
uv run python script.py

# 激活虚拟环境
uv shell
```

## 故障排除

### 常见问题

1. **无法连接到后端**
   - 检查后端服务是否启动
   - 验证后端 URL 配置

2. **语音识别不工作**
   - 检查麦克风权限
   - 验证 Vosk 模型文件是否存在

3. **文件上传失败**
   - 检查文件格式是否支持
   - 验证文件大小是否超限

4. **界面显示异常**
   - 刷新浏览器页面
   - 检查 Gradio 版本兼容性

5. **uv 安装依赖失败**
   - 确保使用 Python 3.11+
   - 检查网络连接和代理设置
   - 尝试重新运行 `uv sync`

6. **虚拟环境问题**
   - 删除 `.venv` 目录重新创建
   - 使用 `uv sync --reinstall` 重新安装依赖

### 日志查看

前端日志会显示在控制台输出中，包括：
- 连接状态
- API 调用结果
- 错误信息

## 开发指南

### 环境管理

本项目使用 uv 进行依赖管理：

```bash
# 添加新依赖
uv add package-name

# 添加开发依赖
uv add --dev package-name

# 更新依赖
uv sync --upgrade

# 运行应用
uv run python app.py
```

### 添加新功能

1. 在 `app.py` 中添加新的函数
2. 更新界面布局
3. 添加事件处理逻辑
4. 测试功能完整性

### 自定义样式

Gradio 支持自定义 CSS 样式，可以通过以下方式修改：

```python
# 在 app.py 中添加自定义 CSS
css = """
.custom-class {
    background-color: #f0f0f0;
}
"""
```

### 依赖管理最佳实践

- 使用 `uv add` 添加新依赖
- 定期运行 `uv sync` 更新依赖
- 在 `pyproject.toml` 中明确指定版本范围

## 许可证

本项目采用 MIT 许可证。详见 [LICENSE](../LICENSE) 文件。

## 相关文档

- [知识库功能详细说明](README_Frontend_KnowledgeBase.md)
- [Wiki 集成功能说明](README_Wiki_Integration.md)
- [后端 API 文档](../backend/README.md) 